---
- block:

    - name: load variables
      include_vars: "{{ ansible_os_family }}.yml"

    - name: install wine
      package:
        name: "{{ wine_pkg_name }}"
        state: installed
      become: yes
      become_user: root

    - name: run wineboot
      command: wine wineboot

    - name: install corefonts and dotnet40
      command: winetricks corefonts dotnet40

    - name: set ddr=gdi
      command: winetricks ddr=gdi

    - name: install ADE 4.5.0
      command: "wine {{ wine_ade45_450_installer_path }} /s NSS=2"

    - name: update to ADE 4.5.LATEST
      unarchive:
        src: "{{ wine_ade45_latest_installer_path }}"
        dest: "${HOME}/{{ wine_ade45_prefix }}/latest_unpacked"

    - name: copy files from LATEST to install
      copy:
        remote_src: yes
        src: "${HOME}/{{ wine_ade45_prefix }}/latest_unpacked/ {{ item }}"
        dest: "${HOME}/{{ wine_ade45_prefix }}"
      with_items:
        - DigitalEditions.exe
        - log4net.dll
        - rmsdk_wrapper.dll

  environment:
    WINEPREFIX: "{{ wine_ade45_prefix }}"
    WINEARCH: "win32"
  tags:
    - wine-ade45
